###########################
# Fourth Balkan War temp
###########################

add_namespace = bw4

# Fourth Balkan War
news_event = {
	id = bw4.1
	#title = bw4.1.t
	title = "Fourth Balkan War"
	#desc = bw4.1.desc
	desc = "bw4_desc"
	#picture = GFX_news_event_BEL_civil_war

	fire_only_once = yes

	trigger = {
		#date > 1937.3.5
		always = no
	}

	is_triggered_only = yes

	mean_time_to_happen = {
		days = 10
	}
	immediate = {
		hidden_effect = {
			add_named_threat = {
				threat = 10
				name = IN_fourth_balkan_war_threat
			}
			GRE = { 
				set_major = yes 
				add_ideas = GRE_surrender_progress_debuff
			}
			ROM = { set_major = yes }
			SER = { set_major = yes }
			set_global_flag = fourth_balkan_war
			HUN = {
				#add_ideas = internationale_buff_2
				create_faction = budapest_sofiagrad_pact
				add_to_faction = BUL
				declare_war_on = {
					target = CZE
					type = annex_everything
				}
				every_owned_state = {
					create_unit = {
						division = "division_template = \"Gyalogdand√°r\" start_experience_factor = 0.6" 
						owner = PREV
						count = 3
					}
				}
			}
			CRO = {
				every_owned_state = {
					create_unit = {
						division = "division_template = \"Pesadijska Divizija\" start_experience_factor = 0.5" 
						owner = PREV
						count = 1
					}
				}
			}
			ROM = {
				declare_war_on = {
					target = BUL
					type = topple_government
				}
			}
			SER = {
				declare_war_on = {
					target = BUL
					type = topple_government
				}
			}
			GRE = {
				declare_war_on = {
					target = BUL
					type = topple_government
				}
			}
			BUL = {
				#add_ideas = internationale_buff_2
				set_major = yes
				set_politics = {
					ruling_party = communism
				}
				set_popularities = {
					auth_communism = 20
					communism = 70
					socialism = 10
				}
				every_owned_state = {
					create_unit = {
						division = "division_template = \"Pekhotna Divizija\" start_experience_factor = 0.5" 
						owner = PREV
						count = 1
					}
				}
				48 = {
					create_unit = {
						division = "division_template = \"Pekhotna Divizija\" start_experience_factor = 0.7" 
						owner = PREV
						count = 6
					}
				}
			}
			45 = { add_claim_by = HUN }
			70 = { add_claim_by = HUN }
			71 = { add_claim_by = HUN }
			73 = { add_claim_by = HUN }
			76 = { add_claim_by = HUN }
			82 = { add_claim_by = HUN }
			84 = { add_claim_by = HUN }
			764 = { add_claim_by = HUN }
			913 = { add_claim_by = HUN }
			78 = { add_claim_by = SOV }
			80 = { add_claim_by = SOV }
			766 = { add_claim_by = SOV }
			912 = { add_claim_by = SOV }
			918 = { add_claim_by = SOV }
			#103 = { add_claim_by = ITA }
		}
	}

	option = {
		#name = bw4.1.a
		name = "The Balkans had always been troublesome."
	}
}
# Fourth Balkan War Prague Entente Surrenders
news_event = {
	id = bw4.2
	#title = bw4.2.t
	title = "Prague Entente Surrenders"
	#desc = bw4.2.desc
	desc = "The Prague Entente succumbs to the Internationale."
	#picture = GFX_news_event_BEL_civil_war

	#fire_only_once = yes

	#is_triggered_only = yes

	hidden = yes

	trigger = {
		has_global_flag = fourth_balkan_war_full
		NOT = { has_global_flag = fourth_balkan_war_HUN_victory }
		NOT = { has_global_flag = fourth_balkan_war_CZE_victory }
		NOT = { has_global_flag = fourth_balkan_war_IN_intervenes }
		NOT = { has_global_flag = ww2 }
		country_exists = YUG
		NOT = { country_exists = SER }
    	NOT = { country_exists = CRO }
		ROM = { is_commie_ideology = yes }
		GRE = { is_commie_ideology = yes }
		HUN = {
			NOT = {
				has_war_with = CZE
			}
			NOT = {
				has_war_with = ROM
			}
			NOT = {
				has_war_with = SER
			}
			NOT = {
				has_war_with = CRO
			}
			NOT = {
				has_war_with = SLV
			}
			NOT = {
				has_war_with = GRE
			}
			NOT = {
				has_war_with = ALB
			}
		}
	}

	immediate = {
		hidden_effect = {
			HUN = {
				remove_ideas = win_this_war_idea
			}
			BUL = {
				remove_ideas = win_this_war_idea
			}
			IF = {
				limit = { NOT = { has_global_flag = fourth_balkan_war_CZE_victory } }
				set_global_flag = fourth_balkan_war_HUN_victory
				HUN = { dismantle_faction = yes }
				every_country = {
					limit = { is_ai = no }
					news_event = {
						id = war_news.17
						days = 1
					}
				}
			}
			ELSE_IF = {
				limit = { has_global_flag = ww2 }
				set_global_flag = fourth_balkan_war_HUN_victory_during_WW2
			}
			SOV = {
				add_to_faction = HUN
				add_to_faction = BUL
				add_to_faction = ROM
				add_to_faction = GRE
				add_to_faction = YUG
				#set_autonomy = { target = ROM autonomy_state = autonomy_puppet }
				#set_autonomy = { target = GRE autonomy_state = autonomy_puppet }
				#set_autonomy = { target = YUG autonomy_state = autonomy_puppet }
			}
			ITA = {
				#transfer_state = 103
				transfer_state = 163
				transfer_state = 948
			}
			ROM = {
				every_owned_state = {
					transfer_state_to = PREV
				}
			}
			CZE = {
				every_owned_state = {
					transfer_state_to = PREV
				}
				IF = {
					limit = { NOT = { country_exists = BOH } }
					transfer_state = 69
					transfer_state = 74
					transfer_state = 919
				}
			}
			IF = {
				limit = {
					183 = {
						is_owned_by = GRE
					}
				}
				CYP = {
					transfer_state = 183 
					set_politics = {
						ruling_party = communism
					}
					set_popularities = {
						communism = 100
					}
				}
				SOV = { add_to_faction = CYP }
				#SOV = { set_autonomy = { target = CYP autonomy_state = autonomy_puppet } }
			}
		}
	}

	option = {
		#name = bw4.2.a
		name = "The Balkans had fallen to the reds..."	
	}		
}
# Fourth Balkan War BUL-HUN Pact Surrenders
news_event = {
	id = bw4.3
	#title = bw4.3.t
	title = "Hungary and Bulgaria Surrender"
	#desc = bw4.3.desc
	desc = "Prague Entente Victory"
	#picture = GFX_news_event_BEL_civil_war

	hidden = yes

	#fire_only_once = yes

	#is_triggered_only = yes

	trigger = {
		has_global_flag = fourth_balkan_war
		NOT = { has_global_flag = fourth_balkan_war_IN_intervenes }
		NOT = { has_global_flag = ww2 }
		NOT = { has_global_flag = fourth_balkan_war_HUN_victory }
		NOT = { has_global_flag = fourth_balkan_war_CZE_victory }
		NOT = {
			OR = {
				SER = { has_war_with = BUL }
				SER = { has_war_with = HUN }
				ROM = { has_war_with = BUL }
				ROM = { has_war_with = HUN }
				GRE = { has_war_with = BUL }
				GRE = { has_war_with = HUN }
				CZE = { has_war_with = BUL }
				CZE = { has_war_with = HUN }
			}
		}
		#country_exists = SER
		NOT = {
			AND = {
				ROM = { is_commie_ideology = yes }
				GRE = { is_commie_ideology = yes }
			}
		}
	}

	immediate = {
		hidden_effect = {
			HUN = {
				every_country = {
					limit = { has_war_with = HUN }
					white_peace = HUN
					white_peace = BUL
					white_peace = YUG
				}
			}
			CZE = {
				remove_ideas = win_this_war_idea
			}
			ROM = {
				remove_ideas = win_this_war_idea
			}
			SER = {
				remove_ideas = win_this_war_idea
			}
			GRE = {
				remove_ideas = win_this_war_idea
			}
			set_global_flag = fourth_balkan_war_CZE_victory
			HUN = {
				every_country = {
					limit = { has_war_with = HUN }
					white_peace = HUN
				}
				dismantle_faction = yes
			}
			BUL = { drop_cosmetic_tag = yes }
			CZE = {
				IF = {
					limit = {
						NOT = { has_cosmetic_tag = CZE_protectorate }
					}
					drop_cosmetic_tag = yes
				}
				every_core_state = {
					limit = {
						is_owned_by = HUN
					}
					transfer_state_to = CZE
				}
			}
			every_country = {
				limit = {
					is_faction_leader = yes
					is_commie_ideology = no
					OR = {
						original_tag = CZE
						original_tag = ROM
						original_tag = GRE
						original_tag = SER
					}
				}
				set_country_flag = p_entente_leader
			}
			ROM = {
				drop_cosmetic_tag = yes
				IF = {
					limit = {
						has_government = communism
					}
					set_politics = {
						ruling_party = neutrality
					}
					set_popularities = {
						neutrality = 70
						communism = 20
						auth_communism = 5
						socialism = 5
					}
					leave_faction = yes
					every_country = {
						limit = {
							has_war_with = ROM
						}
						white_peace = ROM
					}
				}
				every_core_state = {
					limit = {
						OR = {
							is_owned_by = HUN
							is_owned_by = BUL
						}
					}
					transfer_state_to = ROM
				}
			}
			GRE = {
				drop_cosmetic_tag = yes
				IF = {
					limit = {
						has_government = communism
					}
					set_politics = {
						ruling_party = neutrality
					}
					set_popularities = {
						neutrality = 70
						communism = 20
						auth_communism = 5
						socialism = 5
					}
					leave_faction = yes
					every_country = {
						limit = {
							has_war_with = GRE
						}
						white_peace = GRE
					}
				}
				every_core_state = {
					limit = {
						OR = {
							is_owned_by = HUN
							is_owned_by = BUL
						}
					}
					transfer_state_to = GRE
				}
			}
			SER = {
				transfer_state = 45
				transfer_state = 764
				IF = {
					limit = {
						NOT = {
							SLV = { is_subject_of = SER }
						}
					}
					set_autonomy = { 
						target = SLV
						autonomy_state = autonomy_personal_union
					}
				}
				IF = {
					limit = {
						NOT = {
							CRO = { is_subject_of = SER }
						}
					}
					set_autonomy = { 
						target = CRO
						autonomy_state = autonomy_personal_union
					}
				}
				set_autonomy = { 
					target = BUL
					autonomy_state = autonomy_personal_union
				}
				BUL = {
					set_politics = { ruling_party = neutrality }
					set_popularities = {
						auth_communism = 5
						communism = 10
						socialism = 5
						neutrality = 60
						despotism = 20
					}
				}
				every_core_state = {
					limit = { OR = { is_owned_by = YUG is_owned_by = BUL } }
					transfer_state_to = PREV
				}
			}
			CRO = {
				set_politics = {
					ruling_party = neutrality
				}
				every_core_state = {
					limit = { is_owned_by = YUG }
					transfer_state_to = PREV
				}
			}
			SLV = {
				set_politics = {
					ruling_party = neutrality
				}
				every_core_state = {
					limit = { is_owned_by = YUG }
					transfer_state_to = PREV
				}
			}
			ROM = {
				transfer_state = 82
				transfer_state = 83
			}
			4 = {
				owner = {
					transfer_state = 916
				}
			}
			BUL = {
				set_politics = {
					ruling_party = neutrality
				}
				every_owned_state = {
					set_state_controller_to = BUL
				}
			}
			PRG = {
				#set_autonomy = { 
				#	target = HUN
				#	autonomy_state = autonomy_puppet 
				#}
				add_to_faction = ROM
				add_to_faction = GRE
				add_to_faction = SER
			}
			#HUN = {
			#	set_cosmetic_tag = HUN_republic
			#	set_politics = { ruling_party = neutrality }
			#	set_popularities = {
			#		neutrality = 70
			#		communism = 20
			#		auth_communism = 5
			#		socialism = 5
			#	}
			#	every_owned_state = {
			#		HUN = {
			#			delete_unit = { state = PREV disband = yes }
			#		}
			#	}
			#}
			IF = {
				limit = {
					CZE = { has_cosmetic_tag = CZE_protectorate }
				}
				every_state = {
					limit = {
						is_owned_by = HUN
						is_core_of = SLO
					}
					transfer_state_to = SLO
				}
				PRG = { add_to_faction = SLO }
				SLO = { transfer_state = 73 }
			}
			HUN = {
				generic_remove_unowned_cores = yes
				generic_remove_unowned_claims = yes
			}
			SOV = { add_to_faction = HUN }
			every_country = {
				limit = { is_ai = no }
				news_event = {
					id = war_news.18
					days = 1
				}
			}
		}
	}

	option = {
		#name = bw4.3.a
		name = "The Balkans had fallen to the reds..."	
	}		
}
# Fourth Balkan War IN intervenes
news_event = {
	id = bw4.4
	#title = bw4.4.t
	#desc = bw4.4.desc

	fire_only_once = yes

	trigger = {
		date > 1939.5.1
		has_global_flag = fourth_balkan_war
		NOT = { HUN = { is_in_faction_with = SOV } }
		HUN = { has_war = yes }
		NOT = { has_global_flag = fourth_balkan_war_HUN_victory }
		NOT = { has_global_flag = fourth_balkan_war_CZE_victory }
		OR = {
			has_game_rule = {
				rule = BW4_outcome
				option = DEFAULT
			}
			has_game_rule = {
				rule = BW4_outcome
				option = BW4_OUTCOME_HUN_BUL_VICTORY
			}
		}
	}

	immediate = {
		hidden_effect = {
			set_global_flag = fourth_balkan_war_IN_intervenes
			HUN = { dismantle_faction = yes }
			SOV = {
				add_to_faction = HUN
				add_to_faction = BUL
				add_to_faction = YUG
				IF = {
					limit = {
						ROM = {
							OR = {
								has_government = auth_communism
								has_government = communism
								has_government = socialism
							}
						}
					}
					add_to_faction = ROM
				}
				IF = {
					limit = {
						GRE = {
							OR = {
								has_government = auth_communism
								has_government = communism
								has_government = socialism
							}
						}
					}
					add_to_faction = GRE
				}
			}
			every_country = {
				limit = { is_ai = no }
				news_event = {
					id = war_news.21
					days = 1
				}
			}
		}
	}

	mean_time_to_happen = {
		days = 10
	}

	option = {
		name = bw4.4.a
	}		
}
