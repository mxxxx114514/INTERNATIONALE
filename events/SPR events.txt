###########################
# Spanish Events
###########################

add_namespace = spain
add_namespace = spain_news

country_event = {
	id = spain.1
	title = spain.1.t
	desc = spain.1.desc
	#picture = GFX_report_event_wallonian_uprising

	fire_only_once = yes

	trigger = {
		original_tag = SPR
		date > 1936.5.1
	}

	immediate = {
		hidden_effect = {
			add_named_threat = {
				threat = 10
				name = IN_SPR_civil_war_threat
			}
			MOR = { transfer_state = 290 transfer_state = 783 }
			SEN = { transfer_state = 699 transfer_state = 178 }
			RCG = { transfer_state = 297 }
			SPR = {
				set_country_flag = SPR_republican_spain_flag_IN
				every_owned_state = {
					SPR = {
						delete_unit = { state = PREV disband = yes }
					}
				}
				add_ideas = spain_death_before_surrender_capitulation
				clr_country_flag = autdem_coalition_flag
				add_popularity = {
					ideology = auth_communism
					popularity = -0.2
				}
				add_popularity = {
					ideology = communism
					popularity = -0.2
				}
				add_popularity = {
					ideology = socialism
					popularity = -0.2
				}
				add_popularity = {
					ideology = neutrality
					popularity = -0.1
				}
				add_popularity = {
					ideology = despotism
					popularity = -0.2
				}
				add_popularity = {
					ideology = fascism
					popularity = -0.2
				}
				IF = {
					limit = {
						has_game_rule = {
							rule = SCW_outcome
							option = SCW_OUTCOME_SPD_VICTORY
						}
					}
					add_ideas = win_this_war_idea
				}
			}
			create_dynamic_country = {
				original_tag = SPR
				set_country_flag = SPR_nationalist_spain_flag_IN
				set_cosmetic_tag = SPR_nationalist_spain
				add_ideas = spain_death_before_surrender_capitulation
				transfer_state = 170
				transfer_state = 791
				transfer_state = 176
				transfer_state = 166
				transfer_state = 788
				transfer_state = 793
				set_politics = {
					ruling_party = fascism
				}
				set_popularities = {
					fascism = 75
					despotism = 15
					neutrality = 10
				}
				set_capital = { state = 176 }
				reserve_dynamic_country = yes
				IF = {
					limit = {
						has_game_rule = {
							rule = SCW_outcome
							option = SCW_OUTCOME_SPA_VICTORY
						}
					}
					add_ideas = win_this_war_idea
				}
			}
			create_dynamic_country = {
				original_tag = SPR
				set_country_flag = SPR_carlist_spain_flag_IN
				set_cosmetic_tag = SPR_carlist_spain
				add_ideas = spain_death_before_surrender_capitulation
				transfer_state = 171
				transfer_state = 172
				transfer_state = 174
				transfer_state = 792
				set_politics = {
					ruling_party = neutrality
				}
				set_popularities = {
					neutrality = 80
					despotism = 10
					fascism = 10
				}
				set_capital = { state = 171 }
				reserve_dynamic_country = yes
				IF = {
					limit = {
						has_game_rule = {
							rule = SCW_outcome
							option = SCW_OUTCOME_SPB_VICTORY
						}
					}
					add_ideas = win_this_war_idea
				}
			}
			create_dynamic_country = {
				original_tag = SPR
				set_country_flag = SPR_anarchist_spain_flag_IN
				set_cosmetic_tag = SPR_anarchist_spain
				#add_ideas = internationale_buff_2
				add_ideas = spain_death_before_surrender_capitulation
				transfer_state = 165
				transfer_state = 794
				transfer_state = 167
				create_country_leader = {
					name=SPR_jose_diaz
					portraits={
						civilian={
							large=GFX_portrait_SPR_jose_diaz
						}
					}
					country_leader={
						ideology=socialism_subtype
						traits={ veteran_communist }
						expire="1965.1.1.1"
						id=-1
					}
				}
				set_country_flag = autsoc_coalition_flag
				set_country_flag = revsoc_coalition_flag
				set_country_flag = socdem_coalition_flag
				set_politics = {
					ruling_party = socialism
				}
				set_popularities = {
					auth_communism = 3
					communism = 25
					socialism = 45
					social_democratic = 17
					social_liberal = 8
					liberal = 2
				}
				set_capital = { state = 165 }
				reserve_dynamic_country = yes
				IF = {
					limit = {
						has_game_rule = {
							rule = SCW_outcome
							option = SCW_OUTCOME_SPC_VICTORY
						}
					}
					add_ideas = win_this_war_idea
				}
			}
			POR = {
				add_ideas = generic_send_more_volunteers_idea
				add_ai_strategy = {
					type = send_volunteers_desire
					id = SPB
					value = 100
				}
				add_ai_strategy = {
					type = send_lend_lease_desire
					id = SPB
					value = 100
				}
			}
			SOV = {
				add_ai_strategy = {
					type = befriend
					id = SPC
					value = 100
				}
				add_ai_strategy = {
					type = alliance
					id = SPC
					value = 100
				}
				add_ai_strategy = {
					type = send_volunteers_desire
					id = SPC
					value = 100
				}
				add_ai_strategy = {
					type = send_lend_lease_desire
					id = SPC
					value = 100
				}
			}
			FRA = {
				add_ai_strategy = {
					type = befriend
					id = SPC
					value = 100
				}
				add_ai_strategy = {
					type = alliance
					id = SPC
					value = 100
				}
				add_ai_strategy = {
					type = send_volunteers_desire
					id = SPC
					value = 100
				}
				add_ai_strategy = {
					type = send_lend_lease_desire
					id = SPC
					value = 100
				}
			}
			ITA = {
				add_ai_strategy = {
					type = befriend
					id = SPC
					value = 100
				}
				add_ai_strategy = {
					type = alliance
					id = SPC
					value = 100
				}
				add_ai_strategy = {
					type = send_volunteers_desire
					id = SPC
					value = 100
				}
				add_ai_strategy = {
					type = send_lend_lease_desire
					id = SPC
					value = 100
				}
			}
			HUN = {
				add_ai_strategy = {
					type = befriend
					id = SPC
					value = 100
				}
				add_ai_strategy = {
					type = alliance
					id = SPC
					value = 100
				}
				add_ai_strategy = {
					type = send_volunteers_desire
					id = SPC
					value = 100
				}
				add_ai_strategy = {
					type = send_lend_lease_desire
					id = SPC
					value = 100
				}
			}
			SPC = {
				add_ai_strategy = {
					type = befriend
					id = SOV
					value = 100
				}
				add_ai_strategy = {
					type = alliance
					id = SOV
					value = 100
				}
				add_ai_strategy = {
					type = befriend
					id = FRA
					value = 100
				}
				add_ai_strategy = {
					type = alliance
					id = FRA
					value = 100
				}
				add_ai_strategy = {
					type = befriend
					id = ITA
					value = 100
				}
				add_ai_strategy = {
					type = alliance
					id = ITA
					value = 100
				}
				add_ai_strategy = {
					type = befriend
					id = HUN 
					value = 100
				}
				add_ai_strategy = {
					type = alliance
					id = HUN
					value = 100
				}
				add_ai_strategy = {
					type = befriend
					id = MEX
					value = 100
				}
				add_ai_strategy = {
					type = alliance
					id = MEX
					value = 100
				}
			}
			MEX = {
				add_ai_strategy = {
					type = befriend
					id = SPC
					value = 100
				}
				add_ai_strategy = {
					type = alliance
					id = SPC
					value = 100
				}
				add_ai_strategy = {
					type = send_volunteers_desire
					id = SPC
					value = 100
				}
				add_ai_strategy = {
					type = send_lend_lease_desire
					id = SPC
					value = 100
				}
			}
			GER = {
				IF = {
					limit = {
						has_cosmetic_tag = GER_liberal_torch
					}
					add_ai_strategy = {
						type = send_volunteers_desire
						id = SPD
						value = 100
					}
					add_ai_strategy = {
						type = send_lend_lease_desire
						id = SPD
						value = 100
					}
				}
				IF = {
					limit = {
						has_cosmetic_tag = GER_hugenberg
					}
					add_ai_strategy = {
						type = send_volunteers_desire
						id = SPA
						value = 100
					}
					add_ai_strategy = {
						type = send_lend_lease_desire
						id = SPA
						value = 100
					}
				}
				IF = {
					limit = {
						has_cosmetic_tag = GER_kaiserreich
					}
					add_ai_strategy = {
						type = send_volunteers_desire
						id = SPB
						value = 100
					}
					add_ai_strategy = {
						type = send_lend_lease_desire
						id = SPB
						value = 100
					}
				}
			}
			every_country = {
				limit = {
					original_tag = SPR
				}
				add_equipment_to_stockpile = {
					type = infantry_equipment_0
					amount = 50000
				}
				every_other_country = {
					limit = {
						original_tag = SPR
						NOT = { has_war_with = PREV }
					}
					declare_war_on = {
						target = PREV
						type = civil_war
					}
				}
			}
			every_country = {
				limit = {
					OR = {
						tag = SPA
						tag = SPB
						tag = SPC
					}
				}
				every_owned_state = {
					create_unit = {
						division = "division_template = \"División de Infantería\" start_experience_factor = 0.3 start_equipment_factor = 1.0" 
						owner = PREV
						count = 3
					}
				}
			}
			SPA = {
				every_owned_state = {
					create_unit = {
						division = "division_template = \"División de Infantería\" start_experience_factor = 1.0 start_equipment_factor = 1.0" 
						owner = PREV
						count = 6
					}
				}
			}
			SPB = {
				every_owned_state = {
					create_unit = {
						division = "division_template = \"División de Infantería\" start_experience_factor = 0.65 start_equipment_factor = 1.0" 
						owner = PREV
						count = 4
					}
				}
				171 = {
					create_unit = {
						division = "division_template = \"División de Infantería\" start_experience_factor = 0.65 start_equipment_factor = 1.0" 
						owner = PREV
						count = 3
					}
				}
			}
			SPC = {
				every_owned_state = {
					create_unit = {
						division = "division_template = \"División de Infantería\" start_experience_factor = 0.5 start_equipment_factor = 1.0" 
						owner = PREV
						count = 3
					}
				}
				165 = {
					create_unit = {
						division = "division_template = \"División de Infantería\" start_experience_factor = 0.5 start_equipment_factor = 1.0" 
						owner = PREV
						count = 1
					}
				}
			}
			SPD = {
				41 = {
					create_unit = {
						division = "division_template = \"División de Infantería\" start_experience_factor = 0.4 start_equipment_factor = 0.7" 
						owner = PREV
						count = 3
					}
				}
				169 = {
					create_unit = {
						division = "division_template = \"División de Infantería\" start_experience_factor = 0.4 start_equipment_factor = 0.7" 
						owner = PREV
						count = 2
					}
				}
				173 = {
					create_unit = {
						division = "division_template = \"División de Infantería\" start_experience_factor = 0.4 start_equipment_factor = 0.7" 
						owner = PREV
						count = 2
					}
				}
				790 = {
					create_unit = {
						division = "division_template = \"División de Infantería\" start_experience_factor = 0.4 start_equipment_factor = 0.7" 
						owner = PREV
						count = 3
					}
				}
			}
			set_global_flag = spanish_civil_war
			every_country = {
				limit = {
					is_ai = no
				}
				news_event = {
					id = war_news.8
					days = 1
				}
			}
		}	
	}

	option = {
		name = spain.1.a
		
	}
}

country_event = {
	id = spain.2
	fire_only_once = yes

	trigger = {
		has_global_flag = spanish_civil_war
		NOT = { has_global_flag = ww2 }
		country_exists = SPC
		NOT = {
			SPC = {
				OR = {
					has_war_with = POR
					has_war_with = SPA
					has_war_with = SPB
					has_war_with = SPD
				}
			}	
		}
		NOT = { country_exists = SPA }
		NOT = { country_exists = SPB }
		NOT = { country_exists = SPD }
	}

	immediate = {
		hidden_effect = {
			set_global_flag = scw_over
			set_global_flag = scw_over_SPC_victory
			SPC = {
				remove_ideas = win_this_war_idea
				set_cosmetic_tag = SPC_republic
				set_capital = { state = 41 }
				remove_ideas = spain_death_before_surrender_capitulation
				every_core_state = {
					transfer_state_to = SPC
				}
			}
			SOV = { add_to_faction = SPC }
			#activate_targeted_decision = {
				#target = POR
				#decision = POR_occupy_galicia
			#}
			every_country = {
				limit = {
					is_ai = no
				}
				news_event = {
					id = war_news.10
					days = 1
				}
			}
		}
	}
	option = {
		name = spain.2.a
	}
}

country_event = {
	id = spain.3
	fire_only_once = yes

	trigger = {
		tag = SPD
		has_global_flag = spanish_civil_war
		NOT = { has_global_flag = ww2 }
		country_exists = SPD
		NOT = {
			SPD = {
				OR = {
					has_war_with = POR
					has_war_with = SPA
					has_war_with = SPB
					has_war_with = SPC
				}
			}
		}
		NOT = { country_exists = SPA }
		NOT = { country_exists = SPB }
		NOT = { country_exists = SPC }
	}

	immediate = {
		hidden_effect = {
			set_global_flag = scw_over
			set_global_flag = scw_over_SPD_victory
			SPD = {
				remove_ideas = win_this_war_idea
				set_capital = { state = 41 }
				set_major = yes
				remove_ideas = spain_death_before_surrender_capitulation
				#IF = {
				#	limit = {
				#		GER = { has_cosmetic_tag = GER_liberal_torch }
				#	}
				#	IF = {
				#		limit = {
				#			GER = { is_ai = yes}
				#		}
				#		GER = { add_to_faction = SPD }
				#	}
				#	ELSE = {
				#		GER = { country_event = { id = generic.2 days = 1 } }
				#	}
				#}
				#ELSE = {					
				#	IF = {
				#		limit = {
				#			ENG = { is_ai = yes}
				#		}
				#		ENG = { add_to_faction = SPD }
				#	}
				#	ELSE = {
				#		ENG = { country_event = { id = generic.2 days = 1 } }
				#	}
				#}
			}
			every_country = {
				limit = {
					is_ai = no
				}
				news_event = {
					id = war_news.9
					days = 1
				}
			}
		}
	}
	option = {
		name = spain.3.a
	}
}

country_event = {
	id = spain.4
	fire_only_once = yes

	trigger = {
		has_global_flag = spanish_civil_war
		#NOT = { has_global_flag = ww2 }
		country_exists = SPA
		NOT = {
			SPA = {
				OR = {
					has_war_with = POR
					has_war_with = SPB
					has_war_with = SPC
					has_war_with = SPD
				}
			}
		}
		NOT = { country_exists = SPB }
		NOT = { country_exists = SPC }
		NOT = { country_exists = SPD }
	}

	immediate = {
		hidden_effect = {
			set_global_flag = scw_over
			set_global_flag = scw_over_SPA_victory
			SPA = {
				remove_ideas = win_this_war_idea
				set_cosmetic_tag = SPA_natsyn
				set_capital = { state = 41 }
				remove_ideas = spain_death_before_surrender_capitulation
			}
			
			every_country = {
				limit = {
					is_ai = no
				}
				news_event = {
					id = war_news.11
					days = 1
				}
			}
		}
	}
	option = {
		name = spain.4.a
	}
}

country_event = {
	id = spain.5
	fire_only_once = yes

	trigger = {
		has_global_flag = spanish_civil_war
		#NOT = { has_global_flag = ww2 }
		country_exists = SPB
		NOT = {
			SPB = {
				OR = {
					has_war_with = POR
					has_war_with = SPA
					has_war_with = SPC
					has_war_with = SPD
				}
			}	
		}
		NOT = { country_exists = SPA }
		NOT = { country_exists = SPC }
		NOT = { country_exists = SPD }
	}

	immediate = {
		hidden_effect = {
			set_global_flag = scw_over
			set_global_flag = scw_over_SPB_victory
			SPB = {
				remove_ideas = win_this_war_idea
				set_cosmetic_tag = SPB_kingdom
				set_capital = { state = 41 }
				remove_ideas = spain_death_before_surrender_capitulation
			}
			every_country = {
				limit = {
					is_ai = no
				}
				news_event = {
					id = war_news.12
					days = 1
				}
			}
		}
	}
	option = {
		name = spain.5.a
	}
}

news_event = {
	id = spain_news.1
	title = spain_news.1.t
	desc = spain_news.1.desc
	#picture = GFX_news_event_BEL_civil_war

	hidden = yes

	fire_only_once = yes

	#is_triggered_only = yes

	hidden = yes

	trigger = {
		date > 1939.5.1
		country_exists = SPC
		NOT = { has_global_flag = ww2 }
		NOT = { SPC = { is_in_faction_with = SOV } }
		OR = {
			has_game_rule = {
				rule = SCW_outcome
				option = DEFAULT
			}
			has_game_rule = {
				rule = SCW_outcome
				option = SCW_OUTCOME_SPC_VICTORY
			}
		}
	}
	immediate = {
		hidden_effect = {
			SOV = {
				add_to_faction = SPC
			}
			every_country = {
				limit = {
					is_ai = no
				}
				news_event = {
					id = war_news.20
					days = 1
				}
			}
		}
	}

}
